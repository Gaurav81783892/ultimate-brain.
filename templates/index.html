<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: black; color: white; font-family: sans-serif; }
        .bot-msg { background: #1f2937; padding: 10px; border-radius: 10px; border-left: 3px solid #00f2ea; margin-bottom: 10px; max-width: 85%; }
        .user-msg { background: #2563eb; padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 85%; align-self: flex-end; }
        .media-box { border-radius: 10px; margin-top: 5px; max-width: 100%; border: 1px solid #333; }
        #micBtn.listening { background-color: #ef4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Header -->
    <div class="p-4 border-b border-gray-800 bg-gray-900 sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">⚡ SUPER BRAIN</h1>
        <div class="text-[10px] text-gray-400">Audio • Video • Image • Chat</div>
    </div>

    <!-- Chat Area -->
    <div id="chatbox" class="flex-1 overflow-y-auto p-4 flex flex-col">
        <div class="bot-msg">
            Namaste! Main Super AI hu.<br>
            - "Cat ki photo banao"<br>
            - "Car ka video banao"<br>
            - Ya bas baat karo!
        </div>
    </div>

    <!-- Input Area -->
    <div class="p-3 bg-black border-t border-gray-800 flex gap-2 items-center">
        <!-- Mic Button (Speech to Text) -->
        <button id="micBtn" onclick="startListening()" class="bg-gray-800 text-white w-12 h-12 rounded-full flex items-center justify-center border border-gray-600">
            <i class="fa fa-microphone"></i>
        </button>

        <input id="inp" type="text" class="flex-1 bg-gray-900 border border-gray-700 p-3 rounded-full text-white outline-none focus:border-cyan-500" placeholder="Type or Speak...">
        
        <button onclick="send()" class="bg-cyan-600 w-12 h-12 rounded-full text-black flex items-center justify-center font-bold">
            <i class="fa fa-paper-plane"></i>
        </button>
    </div>

    <script>
        // --- 1. SPEECH TO TEXT (Browser Native) ---
        function startListening() {
            const btn = document.getElementById('micBtn');
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'hi-IN'; // Hindi/English mix samjhega
            
            recognition.onstart = () => { btn.classList.add('listening'); };
            recognition.onend = () => { btn.classList.remove('listening'); };
            
            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('inp').value = text;
                send(); // Auto send after speaking
            };
            recognition.start();
        }

        // --- 2. SEND MESSAGE ---
        async function send() {
            let txt = document.getElementById('inp').value;
            if(!txt) return;

            let box = document.getElementById('chatbox');
            box.innerHTML += `<div class="user-msg">${txt}</div>`;
            document.getElementById('inp').value = "";
            box.scrollTop = box.scrollHeight;

            // Loading
            let loadId = Date.now();
            box.innerHTML += `<div id="${loadId}" class="text-gray-500 text-xs ml-2 animate-pulse">Thinking...</div>`;

            let res = await fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: txt })
            });
            let data = await res.json();
            
            document.getElementById(loadId).remove();

            // Handle Response Type
            let contentHtml = "";
            if (data.type === "image") {
                contentHtml = `<p>${data.text}</p><img src="${data.content}" class="media-box">`;
            } else {
                contentHtml = `<p>${data.content.replace(/\n/g, '<br>')}</p>`;
            }

            // Append Message with Audio Button
            box.innerHTML += `
                <div class="bot-msg">
                    ${contentHtml}
                    <button onclick="speakText(this)" data-text="${data.type === 'text' ? data.content : data.text}" class="text-xs text-cyan-400 mt-2 border border-cyan-900 px-2 py-1 rounded flex items-center gap-2">
                        <i class="fa fa-volume-up"></i> Listen
                    </button>
                </div>
            `;
            box.scrollTop = box.scrollHeight;
        }

        // --- 3. TEXT TO SPEECH (Audio Play) ---
        async function speakText(btn) {
            let txt = btn.getAttribute('data-text');
            btn.innerHTML = "<i class='fa fa-spinner fa-spin'></i> Loading...";
            
            let res = await fetch('/speak', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ text: txt })
            });
            let data = await res.json();
            
            let audio = new Audio(data.url + "?t=" + new Date().getTime());
            audio.play();
            
            audio.onended = () => { btn.innerHTML = "<i class='fa fa-volume-up'></i> Listen"; };
            btn.innerHTML = "<i class='fa fa-stop'></i> Playing...";
        }
    </script>
</body>
      </html>
